{% extends "base.html" %}
{% load static %}



{% block content %}

    <br>
    <h3>Goals determine your direction. Systems determine your progress.</h3>
    {% if payload|length < 1 %}
    <div class="row">
        <p class="text-secondary">You haven't created any goal yet!</p>
    </div>
    {% endif %}

    {% for g in payload %}
        <p style="font-size: 20px;"><i class="fas fa-star"></i> Your goal is to <span class="badge badge-warning">{{ g.goal }}</span> <i class="fas fa-arrow-right"></i> Your system is to

        {% if g.systems|length < 1 %}
            <span class="badge badge-warning">Click to define</span>
        {% endif %}

        {% if g.systems|length == 1 %}
            <span style="background-color: #{{ g.systems.0.system.color }}" class="badge badge-warning">{{ g.systems.0.system }}</span>
        {% endif %}

        {% if g.systems|length > 1 %}
            {% for s in g.systems %}
                <span style="background-color: #{{ s.system.color }}" class="badge badge-warning">{{ s.system }}</span>
            {% endfor %}
        {% endif %}

        </p>
    {% endfor %}

    <br>
    <h3>Try not to break the chain.</h3>
    <h4>Calendar View</h4>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                headerToolbar: { center: 'dayGridMonth,dayGridWeek' },
                initialView: 'dayGridMonth',
                events: [
                    {% for g in payload %}
                        {% for s in g.systems %}
                            {% for p in s.progress %}
                                {% if p.is_completed %} 
                                    {
                                        {% if p.measurable_data is not none %} 
                                            title: '{{ p.system.name|safe }} - {{ p.measurable_data|safe }} {{ p.system.measurable_unit|safe }}',
                                        {% else %}
                                            {% if p.measurable_context|length %} 
                                            title: '{{ p.measurable_context|safe }}',
                                            {% else %}
                                                title: '{{ p.system.name|safe }}',
                                            {% endif %}
                                        {% endif %}
                                        start: '{{ p.date|safe }}',
                                        end: '{{ p.date|safe }}',
                                        color: '#{{ p.system.color|safe }}',
                                    },
                                {% else %}
                                    {
                                        {% if p.measurable_data is not none %} 
                                            title: '{{ p.system.name|safe }} - {{ p.measurable_data|safe }} {{ p.system.measurable_unit|safe }}',
                                        {% else %}
                                            title: '{{ p.system.name|safe }}',
                                        {% endif %}
                                        start: '{{ p.date|safe }}',
                                        end: '{{ p.date|safe }}',
                                        color: '#6c757d',
                                    },
                                {% endif %}
                            {% endfor %}
                        {% endfor %}
                    {% endfor %}
                ]
            });
            calendar.render();
        });
    </script>
    <div id='calendar'></div>

    <br>
    <h4>Chart View</h4>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var ctx = document.getElementById('myChart').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [
                        {% for g in payload %}
                            {% for s in g.systems %}
                                {
                                    {% if s.system.measurable_unit|length %} 
                                        label: '{{ s.system.name|safe }} ({{ s.system.measurable_unit|safe }})',
                                    {% else %}
                                        label: '{{ s.system.name|safe }}',
                                    {% endif %}
                                    borderColor: '#{{ s.system.color|safe }}',
                                    borderWidth: 1.5,
                                    fill: false,
                                    data: [
                                        {% for p in s.progress %}
                                            {% if p.measurable_data is not none %} 
                                                { x: '{{ p.date|safe }}', y: '{{ p.measurable_data|safe }}' },
                                            {% else %}
                                                { x: '{{ p.date|safe }}', y: 0 },
                                            {% endif %}
                                        {% endfor %}
                                    ],
                                },
                            {% endfor %}
                        {% endfor %}
                    ],
                },
                options: {
                    scales: {
                        xAxes: [
                            {
                                type: 'time',
                                distribution: "series",
                            },
                        ],
                    },
                },
            });
        });
    </script>
    <canvas id="myChart"></canvas>


{% endblock content %}
